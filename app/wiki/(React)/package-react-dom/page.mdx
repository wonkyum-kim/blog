import { CodeSelector } from '@/components/code-selector.tsx'

# 📝 작성 중...

## react-dom 패키지

`react-dom` 패키지는 DOM의 엔트리 포인트 역할을 하고 React를 위한 렌더러를 제공한다.

크게 `react-dom`, `react-dom/client`, `react-dom/server`로 구분된다.

## react-dom

### \_\_DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE

구현체: https://github.com/facebook/react/blob/main/packages/react-dom/src/ReactDOMSharedInternals.js

react-dom 패키지 내부에서 사용되는 객체다.

내부 코드에서는 `ReactDOMSharedInternals`라는 이름으로 사용된다.

### createPortal

구현체: [src/shared/ReactDOM.js](https://github.com/facebook/react/blob/main/packages/react-dom/src/shared/ReactDOM.js)

문서: https://19.react.dev/reference/react-dom/createPortal

`createPortal`은 DOM의 다른 부분에 children을 렌더링하도록 해준다.

주로 modal을 만들거나 React로 만들어지지 않은 부분에 React 컴포넌트를 렌더링하고 싶을 때 사용된다.

이것의 구현은 react-dom이 아니라 react-conciler에 있다.

그래도 잠깐만 구현을 살펴보고 오면, 그저 주어진 정보에 맞는 React 엘리먼트를 반환하고 있는 것을 확인할 수 있다.

### flushSync

구현체: [src/shared/ReactDOMFlushSync.js](https://github.com/facebook/react/blob/main/packages/react-dom/src/shared/ReactDOMFlushSync.js)

문서: https://19.react.dev/reference/react-dom/flushSync

`flushSync`는 React가 제공된 콜백 내부의 모든 업데이트를 동기식으로 플러시하도록 한다.

즉, DOM이 즉시 업데이트되는 것을 보장한다.

<CodeSelector names={['jsx']} desc='ex1' />

```jsx
flushSync(() => {
  setState('hi')
})

// 다음 줄 부터 DOM이 업데이트 되었음이 보장된다.
```

flushSync는 퍼포먼스에 안좋은 영향을 끼칠 수 있지만, 브라우저 API와 같은 서드 파티와 React를 같이 써야할 때 주로 사용한다.

예를 들어 `View Transition API`에서 같이 사용하면 좋다.

구현을 살펴보면 내부 객체와 react-conciler가 등장하기에 지금은 자세히 알 수 없지만, 컨텍스트 스위칭을 통해 구현이 이루어지는 것을 확인할 수 있다.

### prefetchDNS

구현체: [src/shared/ReactDOMFloat.js](https://github.com/facebook/react/blob/main/packages/react-dom/src/shared/ReactDOMFloat.js)

문서: https://19.react.dev/reference/react-dom/prefetchDNS

DNS를 조회하여 IP 주소를 미리 얻도록 하는 방법

리소스 요청 전 DNS 조회 시간 단축할 목적으로 사용한다.

### preconnect

구현체: [src/shared/ReactDOMFloat.js](https://github.com/facebook/react/blob/main/packages/react-dom/src/shared/ReactDOMFloat.js)

문서: https://19.react.dev/reference/react-dom/preconnect

DNS 조회 외에도 TCP 핸드셰이크와 TLS 네고시에이션까지 미리 수행하는 방법

리소스 요청 전 모든 초기 연결 설정 작업 완료할 목적으로 사용한다.

### preload

구현체: [src/shared/ReactDOMFloat.js](https://github.com/facebook/react/blob/main/packages/react-dom/src/shared/ReactDOMFloat.js)

문서: https://19.react.dev/reference/react-dom/preload

현재 페이지 렌더링에 필요한 중요한 리소스를 미리 로드하는 방법.

페이지 로드 중 반드시 필요한 리소스를 미리 로드할 때 사용한다.

### preloadModule

구현체: [src/shared/ReactDOMFloat.js](https://github.com/facebook/react/blob/main/packages/react-dom/src/shared/ReactDOMFloat.js)

문서: https://19.react.dev/reference/react-dom/preloadModule

외부 스크립트 중 ESM module을 미리 로딩(preload)하는 방법.

preload의 스크립트 버전이라고 생각하면 된다.

### preinit

구현체: [src/shared/ReactDOMFloat.js](https://github.com/facebook/react/blob/main/packages/react-dom/src/shared/ReactDOMFloat.js)

문서: https://19.react.dev/reference/react-dom/preinit

preload는 불러오는 것까지만 하지만, preinit은 실행까지 한다.

### preinitModule

구현체: [src/shared/ReactDOMFloat.js](https://github.com/facebook/react/blob/main/packages/react-dom/src/shared/ReactDOMFloat.js)

문서: https://19.react.dev/reference/react-dom/preinitModule

preinit과 비슷하지만, 스크립트가 ESM인 경우 사용한다.

### requestFormReset

문서도 아직 없고 구현은 `react-dom-bindings` 패키지에 있다.

https://19.react.dev/blog/2024/04/25/react-19#form-actions 에 따르면 `<form>`을 수동으로 초기화 시키는 API라고 한다.

자세한 것은 문서가 나와야 알 수 있을 것이다.

### useFormStatus

구현체: [react-dom-bindings/src/shared/ReactDOMFormActions.js](https://github.com/facebook/react/blob/main/packages/react-dom-bindings/src/shared/ReactDOMFormActions.js)

문서: https://19.react.dev/reference/react-dom/hooks/useFormStatus

react 패키지의 훅도 마찬가지였지만, 자세한 구현은 dispatch에 있기 때문에 현재는 알 수 없어서 어떤 역할을 하는지만 살펴본다.

`useFormStatus`는 지난 form 제출의 상태 정보를 제공하는 훅이다.

반드시 `<form>`이 있는 컴포넌트가 렌더링하는 다른 자식 컴포넌트에서 사용해야 한다는 것이 특이하다.

## react-dom/client

### createRoot

구현체: [src/client/ReactDOMRoot.js](https://github.com/facebook/react/blob/main/packages/react-dom/src/client/ReactDOMRoot.js)

문서: https://19.react.dev/reference/react-dom/client/createRoot

브라우저 DOM 엘리먼트 안에 내용을 표시하기 위해서 React 루트를 생성하는 함수다.

<CodeSelector names={['index.js', 'index.html']} desc='ex2' />

```jsx
import { createRoot } from 'react-dom/client'
import App from './App.js'
import './styles.css'

const root = createRoot(document.getElementById('root'))
root.render(<App />)
```

```html
<!doctype html>
<html>
  <head>
    <title>My app</title>
  </head>
  <body>
    <!-- This is the DOM node -->
    <div id="root"></div>
  </body>
</html>
```

`createRoot`의 구현을 보면 react-reconciler와 react-dom-bindings 패키지 코드를 사용하고 있어서 지금 자세히 살펴보기는 어렵다.

### hydrateRoot

구현체:

문서: https://19.react.dev/reference/react-dom/client/hydrateRoot

## react-dom/server

TODO
