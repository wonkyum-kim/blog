import { CodeSelector } from '@/components/code-selector.tsx'

# ğŸ“ ì‘ì„± ì¤‘...

## react-dom/client

### createRoot

`createRoot`ëŠ” `ReactDOMRoot`ë¥¼ ìƒì„±í•˜ëŠ” í•¨ìˆ˜ë‹¤.

<CodeSelector names={['index.js']} desc='ex1' />

```jsx
import { createRoot } from 'react-dom/client'

// root: ReactDOMRoot
const root = createRoot(document.getElementById('root'))
```

> ì§€ê¸ˆë¶€í„° createRootê°€ ë™ì‘í•˜ëŠ” ê³¼ì •ì„ ì‚´í´ë³¼ ê²ƒì¸ë°, react-reconciler ë¶€ë¶„ì„ ë¨¼ì € ì½ê³  ì˜¤ëŠ” ê²ƒì´ ë„ì›€ì´ ëœë‹¤.

1ë‹¨ê³„: createContainerë¥¼ í˜¸ì¶œí•˜ì—¬ FiberRootNodeë¥¼ ìƒì„±í•œë‹¤.

createContainerëŠ” createFiberRootë¥¼ í˜¸ì¶œí•˜ê³ , createFiberRootëŠ” FiberRootNodeë¥¼ ìƒì„±í•˜ì—¬ ë°˜í™˜í•œë‹¤.

FiberRootNodeëŠ” Fiber ê°ì²´ë¥¼ í¬í•¨í•˜ê³  ìˆëŠ” ê°ì²´ë¼ê³  ìƒê°í•˜ë©´ëœë‹¤.

disableLegacyModeê°€ trueì´ê¸° ë•Œë¬¸ì— Fiber.modeëŠ” ConcurrentModeë¡œ ì„¤ì •ëœë‹¤.

ì‹¤ì œ Fiber ê°ì²´ê°€ ìƒì„±ë˜ëŠ” createFiber ë¶€ë¶„ì€ react-reconcilerë¥¼ ì°¸ê³ í•œë‹¤.

(TODO)ìºì‹œ ê´€ë ¨í•´ì„œëŠ” ì•„ì§ ë¬´ì—‡ì¸ì§€ íŒŒì•…í•˜ì§€ ëª»í–ˆë‹¤.

ë§ˆì§€ë§‰ìœ¼ë¡œ Fiber ê°ì²´ì— update íë¥¼ ì¶”ê°€í•´ì£¼ê³  ë§ˆë¬´ë¦¬ëœë‹¤.

<CodeSelector
  names={['createRoot', 'createContainer', 'createFiberRoot', 'createHostRootFiber']}
  desc='ex2'
/>

```ts {6-11} showLineNumbers
export function createRoot(
  container: Element | Document | DocumentFragment,
  options?: CreateRootOptions
): RootType {
  /* ... */
  // 1ë‹¨ê³„: createContainerë¥¼ í˜¸ì¶œí•˜ì—¬ FiberRootNodeë¥¼ ìƒì„±í•œë‹¤.
  const root = createContainer(
    container,
    ConcurrentRoot
    /* ... */
  )
  /* ... */
}
```

```ts {7-11} showLineNumbers
export function createContainer(
  containerInfo: Container,
  tag: RootTag
  /* ... */
): OpaqueRoot {
  // ...
  return createFiberRoot(
    containerInfo,
    tag
    /* ... */
  )
}
```

```ts {7-12, 16-19, 43-44} showLineNumbers
export function createFiberRoot(
  containerInfo: Container,
  tag: RootTag,
  /* ... */
): FiberRoot {

  // 1. FiberRootNodeë¥¼ ìƒì„±í•œë‹¤.
  const root: FiberRoot = (new FiberRootNode(
    containerInfo,
    tag,
    /* ... */
  ): any);

  /* ... */

  // 2. FiberRootNode.currentì— Fiber ê°ì²´ë¥¼ ë„£ëŠ”ë‹¤.
  const uninitializedFiber = createHostRootFiber(tag, isStrictMode);
  root.current = uninitializedFiber;
  uninitializedFiber.stateNode = root;

  // 3. cache ê´€ë ¨
  if (enableCache) {
    const initialCache = createCache();
    retainCache(initialCache);

    // The pooledCache is a fresh cache instance that is used temporarily
    // for newly mounted boundaries during a render. In general, the
    // pooledCache is always cleared from the root at the end of a render:
    // it is either released when render commits, or moved to an Offscreen
    // component if rendering suspends. Because the lifetime of the pooled
    // cache is distinct from the main memoizedState.cache, it must be
    // retained separately.
    root.pooledCache = initialCache;
    retainCache(initialCache);
    const initialState: RootState = {
      element: initialChildren,
      isDehydrated: hydrate,
      cache: initialCache,
    };
    uninitializedFiber.memoizedState = initialState;
  } else { /* ... */ }

  // 4. Fiber ê°ì²´ì— updateQueueë¥¼ ì¶”ê°€í•œë‹¤.
  initializeUpdateQueue(uninitializedFiber);

  return root;
}
```

```ts {4, 10} showLineNumbers
export function createHostRootFiber(tag: RootTag, isStrictMode: boolean): Fiber {
  let mode
  if (disableLegacyMode || tag === ConcurrentRoot) {
    mode = ConcurrentMode
    /* ... */
  } else {
    mode = NoMode
  }
  /* ... */
  return createFiber(HostRoot, null, null, mode)
}
```

2ë‹¨ê³„: TODO

<CodeSelector names={['createRoot']} desc='ex3' />

```ts showLineNumbers
export function createRoot(
  container: Element | Document | DocumentFragment,
  options?: CreateRootOptions
): RootType {
  /* ... */
  // 2ë‹¨ê³„:
  markContainerAsRoot(root.current, container)
}
```

### hydrateRoot

TODO
