import { CodeSelector } from '@/components/code-selector.tsx'

## 공변적(covariant)

`lval`의 타입을 L, `rval`의 타입을 R이라 하자.

L의 모든 프로퍼티 P에 대하여 $L[P] \gtrsim R[P]$ 이면 $L \gtrsim P$ 인 것을 공변적이라고 한다.

객체의 타입은 프로퍼티의 타입에 대해 공변적이다.

<CodeSelector names={['covariant']} desc='covariant' />

```ts
interface L {
  x: number
  y?: string
  z: boolean
}

const foo: L = {
  x: 3,
  z: false,
  a: 'foo',
}

// 1. x는 number인데, 3을 포함한다.
// 2. y는 string | undefined로 undefined보다 큼
// 3. z는 boolean인데 false를 포함한다.
// 4. a는 L의 key가 아니므로 상관 없음
```

## 반변적(contravariant)

반변적이라는 것은 공변적인 것의 반대라고 생각하면 된다.

함수의 타입은 반환형에 대해서는 `공변적`이지만, 인자형에 대해서는 `반변적`이어야 한다.

A가 B의 서브타입이라면, 인자형이 같을 때 A를 반환하는 함수가 B를 반환하는 함수의 서브타입이 된다. (자명하다.)

A가 B의 서브타입이라면, 반환형이 같을 때, B를 인자로 같는 함수는 A를 인자로 갖는 함수의 서브타입이다.(왜?)

<CodeSelector names={['contravariant']} desc='contravariant' />

```ts
function processNumber(x: number) {}
function processNumberAndString(x: number | string) {}

// A를 number라고 하고, B를 number | string이라고 생각해보자.
// A는 B의 서브타입이라는 것은 자명하다.
// 두 함수의 반환형이 같을 때, B를 인자로 같는 함수는 A를 인자로 갖는 함수의 서브타입이 된다.

let wide: (x: number) => void
// A를 인자로 갖는 함수를 대입한다.
wide = processNumber
// B를 인자로 갖는 함수를 대입할 수 있다.
// 반변적인 특성: A < B 이지만, f(A) > f(B).
// 이것이 가능한 이유는, number는 processNumber과 processNumberAndString 모두 대입할 수 있기 때문
wide = processNumberAndString

let narrow: (x: number | string) => void
// ❌ A를 인자로 갖는 함수는 슈퍼타입이기 때문에 불가능
// 이것이 불가능한 이유는, processNumber는 number만 들어갈 수 있기 때문
narrow = processNumber
// 가능
narrow = processNumberAndString
```

인자의 수가 불일치 하는 경우, 인자가 적은 함수가 인자가 많은 함수의 서브타입이 된다.(왜?)

그 함수를 사용하는 곳에서 넣어줘야 할 인자를 안넣어주는 상황을 방지하기 위함.

<CodeSelector names={['contravariant']} desc='contravariant2' />

```ts
function consumeOneArg(x: any) {}

let wide: (x: any, y: any) => void
wide = consumeOneArg
// 가능. 두 번째 인자를 그냥 무시하면 되기 때문
wide(0, 1)

function consumeTwoArg(x: any, y: any) {}

let narrow: (x: any) => void
// 불가능.
narrow = consumeTowArg
```

## References

- [infer, never만 보면 두려워지는 당신을 위한 고급 TypeScript](https://www.youtube.com/watch?v=xesy1i67OWI&list=WL&index=57&t=1573s)
