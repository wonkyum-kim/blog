import { CodeSelector } from '@/components/code-selector.tsx'
import { ToolTip } from '@/components/tooltip.tsx'
import { Title } from '@/components/title'
import { TOC } from '@/components/toc'
import { getHeadingsBySlug } from '@/lib/mdx'

<Title slug={'framer-motion-proxy'} />

<TOC headings={getHeadingsBySlug('framer-motion-proxy')} />

## motion의 사용 방법

`framer-motion`에서 `motion`을 사용하는 방법은 2가지가 있다.

<CodeSelector names={['first', 'second']} desc='useage' />

```tsx showLineNumbers
// 1. motion에 React 컴포넌트를 직접 건네준다.

const Component = React.forwardRef((props, ref) => <div ref={ref} />)

const MotionComponent = motion(Component)
```

```tsx showLineNumbers
// 2. <motion.div>와 같이 JSX 형태로 사용한다.

<motion.div />
```

`motion`이라는 하나의 코드로 두 가지 방법을 사용할 수 있는 것이 신기해서 코드를 살펴보게 되었다.

## Proxy 패턴

`Proxy`는 특정 객체를 감싸 프로퍼티 읽기, 쓰기와 같은 객체에 가해지는 작업을 중간에서 가로채는 객체를 의미한다.

framer-motion은 Proxy의 get트랩을 사용한 흥미로운 방법을 사용하고 있었다.

<CodeSelector names={['proxy.js']} desc='proxy' />

```tsx showLineNumbers
function foo(a) {
  return a
}

foo = new Proxy(foo, {
  get: (_target, key) => {
    console.log('Proxy!')
    return key
  },
})

foo('div') // get 트랩이 적용되지 않음, 'div' 반환
foo['div'] // get 트랩이 적용됨, 'Proxy!' 출력 & 'div' 반환
```

Proxy가 객체의 프로퍼티에 접근하면 get 트랩이 발동하지만, 함수 호출의 경우 get 트랩은 작동하지 않는다.

framer-motion은 바로 이 점을 노려서 설계되었다.

레퍼런스로 남긴 코드를 살펴보면, framer-motion은 get 트랩을 사용해 컴포넌트를 캐싱하는데 사용하고 있다.

## References

- [motion-proxy.ts](https://github.com/framer/motion/blob/main/packages/framer-motion/src/render/dom/motion-proxy.ts)
