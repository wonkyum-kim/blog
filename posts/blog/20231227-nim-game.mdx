---
title: 님 게임(Nim game)
date: 2023-12-27
description: 님 게임을 반드시 이기는 조건들
---

## 님 게임(Nim game)

`님 게임`에서는 더미 n개가 존재하며, 각각의 더미에는 돌이 여러 개 존재합니다.

플레이어는 번갈아가며, 돌이 남아있는 더미를 하나 고른 뒤 그 더미에서 임의의 개수 만큼의 돌을 제거하며 마지막 돌을 제거하는 사람이 승리합니다.

님 게임의 상태는 $[x_1, x_2, ... , x_n]$의 형태로 되어 있으며, $x_i$는 i번째 더미에 있는 돌의 개수를 의미합니다.

$[0,0, ..., 0]$은 더 이상 제거할 수 있는 돌이 없으므로 패배 상태가 됩니다.

님 게임의 상태를 `님 합(nim sum)`으로 표현할 수 있으며, $s = x_1 ⊕ x_2 ⊕ ... ⊕ x_n$로 구할 수 있습니다. (⊕는 xor 연산을 의미)

님 합이 0이 되는 경우는 패배 상태이며, 나머지 상태는 모두 승리 상태가 됩니다.

각 플레이어가 최적의 방법으로 게임을 진행한다면, 님 합이 0이 아니면 선공이 승리하고, 님 합이 0이면 후공이 승리합니다.

### 승리 전략

예를 들어, 더미 3개에 돌이 각각 3, 4, 5개 들어있다고 한다면 님 합은 다음과 같이 구할 수 있습니다.

```
Binary  Decimal

  011      3    Heap A
  100      4    Heap B
  101      5    Heap C
  ---
  010      2    The nim-sum of heaps A, B, and C, 3 ⊕ 4 ⊕ 5 = 2
```

님 게임에서 승리 전략은 모든 움직임을 님 합이 0으로 만드는 것입니다.

즉, 이동 전 님 합이 0이 아니면 항상 님 합을 0으로 만들 수 있고 승리할 수 있습니다.

예를 들어 현재 님 합을 X (X != 0)라고 했을 때, X와 어떤 더미의 돌 개수의 님 합을 구했을 때 X보다 작은 더미를 찾습니다.

위의 예에서 님 합은 X = 2이고, A=3, B=4, C=5과 님 합은 다음과 같습니다.

```
A ⊕ X = 3 ⊕ 2 = 1
B ⊕ X = 4 ⊕ 2 = 6
C ⊕ X = 5 ⊕ 2 = 7
```

X보다 작은 결과가 나오는 유일한 더미는 A이므로, 승리하는 방법은 A의 크기를 1로 줄이는 것입니다. (즉, 돌을 2개 가져갑니다.)

이 과정을 게임이 끝날 때 까지 반복하면 선공이 승리하게 됩니다.

### 승리 전략 증명

**Theorem**: 님 게임에서는 님 합이 0이 아닌 경우에만 선공이 승리 전략을 가진다. 그렇지 않으면 후공이 승리 전략을 가진다.

_Proof_:

$x_1, x_2, ... , x_n$을 이동 전 더미의 돌의 개수로 설정하고, $y_1, y_2, ... , y_n$을 이동 후 더미의 돌의 개수로 설정합니다.

그리고 s = $x_1$ ⊕ ... ⊕ $x_n$, t = $y_1$ ⊕ ... ⊕ $y_n$라고 합시다.

돌을 가져간 더미가 k라면, 모든 i ≠ k에 대해서 $x_i$ = $y_i$이고, $x_k$ > $y_k$가 될 것입니다.

```
    t = 0 ⊕ t
      = s ⊕ s ⊕ t
      = s ⊕ (x1 ⊕ ... ⊕ xn) ⊕ (y1 ⊕ ... ⊕ yn)
      = s ⊕ (x1 ⊕ y1) ⊕ ... ⊕ (xn ⊕ yn)
      = s ⊕ 0 ⊕ ... ⊕ 0 ⊕ (xk ⊕ yk) ⊕ 0 ⊕ ... ⊕ 0
      = s ⊕ xk ⊕ yk

(*) t = s ⊕ xk ⊕ yk.
```

**Lemma 1**. s = 0이면 어떤 움직임이 이루어지더라도 t ≠ 0이다.

t = 0 ⊕ $x_k$ ⊕ $y_k$가 되는데, $x_k$ != $y_k$ 이므로 참임을 보일 수 있습니다.

**Lemma 2**. _s_ ≠ 0이면 _t_ = 0이 되도록 움직일 수 있다.

d를 s를 이진 수로 표현했을 때, 0이 아닌 최상위 비트의 위치라고 해봅시다.

그리고 $x_k$ 를 이진 수로 표현했을 때, d의 위치에서 0이 아닌 k를 선택합니다.

(k는 반드시 존재해야 하는데, 존재하지 않는다면 s의 d번째 비트가 0이 되기 때문입니다.)

$y_k$ = s ⊕ $x_k$가 되도록 $x_k$에서 돌을 가져가도록 한다면, 다음과 같이 t가 0이 됨을 보일 수 있습니다.

```
t = s ⊕ xk ⊕ yk           (by (*))
  = s ⊕ xk ⊕ (s ⊕ xk)
  = 0.
```

## 미제르 님 게임(Misère Nim Game)

`미제르 님 게임`은 님 게임과 유사한 게임인데, 마지막 돌을 제거하는 사람이 패배합니다.

여기에 한 가지 전략이 더 추가됩니다.

초기 상태 또는 다음 움직임 후에 모든 더미에 최대 한 개의 돌이 남게 된다면, 돌이 하나만 남은 더미의 개수를 홀수가 되도록 움직여야 합니다.

### 승리 전략

미제르 님 게임에서는 다음 움직임으로 인해 모든 더미의 돌이 최대 한 개가 될 때때 전략의 차이가 발생합니다.

이 경우, 올바른 이동 방법은 돌의 개수가 1인 더미의 개수를 홀수 개로 만드는 것입니다.

```
A B C nim-sum(binary, decimal)

3 4 5 010 = 2   I take 2 from A, leaving a sum of 000, so I will win.
1 4 5 000 = 0   You take 2 from C
1 4 3 110 = 6   I take 2 from B
1 2 3 000 = 0   You take 1 from C
1 2 2 001 = 1   I take 1 from A
0 2 2 000 = 0   You take 1 from C
0 2 1 011 = 3   The normal play strategy would be to take 1 from B, leaving an even number (2)
                 heaps of size 1.  For misère play, I take the entire B heap, to leave an odd
                 number (1) of heaps of size 1.
0 0 1 001 = 1   You take 1 from C, and lose.
```

### 승리 전략 증명

case1. 초기 더미의 돌이 모두 1개인 경우

더미의 개수가 짝수면 선공이 더미의 개수를 홀수 개로 만들 수 있으므로 승리하고, 더미의 개수가 홀수면 후공이 승리하게 됩니다.

case 2. 돌이 2개 이상 들어있는 더미가 존재하는 경우

서로 님 게임처럼 진행하다가, 현재 턴이 끝나고 모든 더미들이 돌을 1개 이하를 가지게 될 때, 돌의 개수가 1인 더미의 개수가 홀수인지 짝수인지에 따라서 승리가 갈리게 됩니다.

예를 들어 $x_1 \geq 2$이고, $x_2, ..., x_n \leq 1$ 이라고 해봅시다.

돌을 가져가서 x1에 남아있는 돌의 개수를 0 또는 1로 만들 수 있고, 이에 따라서 승패를 결정할 수 있습니다.

항상 $x_2$ ⊕ ... ⊕ $x_n$은 0 또는 1이 되므로 님 합 s는 0이 아닌 수가 되어 승리할 수 있습니다.

이 방법이 성립하는 이유는 게임을 진행하다 보면 돌이 한 개보다 많은 더미가 정확히 하나 존재하는 상황이 반드시 일어나기 때문입니다.

그리고 이 게임의 패배 상태는 $[0,0, ..., 1]$인데, $[2,1, 1, ..., 1]$와 같은 상황에서 항상 패배 상태로 이동할 수 있으므로(2를 0 또는 1로 만들면 됩니다.) 게임 이론에 따라서 승리 상태가 됩니다.

또한, 님 합이 0이 아닌 상태($[2,1, 1, ..., 1]$)에서 님 합이 항상 1인 상태( $[0,0, ..., 1]$) 이동하게 되므로 님 합이 0이 아닐 때 선공이 승리한다는 것도 알 수 있습니다.

(님 게임 증명의 `t = s ⊕ xk ⊕ yk`에 대입해서 계산해보면 됩니다.)

## References

https://en.wikipedia.org/wiki/Nim

https://brilliant.org/wiki/nim/
