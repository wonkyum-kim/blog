---
title: 환경 레코드(Environment Record)와 실행 컨텍스트(Execution Context)
date: 2023-12-21
description: ECMAScript 명세서 읽어보기
---

## 환경 레코드

`환경 레코드`는 명세서 타입(specification type, 실재하지 않지만 가상적으로 존재하는 타입)으로 변수나 함수를 특정하기 위하여 식별자들의 연결을 정의하는데 사용됩니다.

일반적으로 환경 레코드는 코드의 특정 구문 구조와 연결되기 때문에, 해당 코드에 의해 생성된 식별자 바인딩을 기록하기 위해 새로운 환경 레코드가 생성됩니다.

모든 환경 레코드에는 `[[OuterEnv]]`라는 필드를 가지고 있는데, 값은 null이거나 외부 환경 레코드에 대한 참조로 설정됩니다.

즉, 내부 환경 레코드의 외부 참조는 이를 둘러싸고 있는 외부 환경 레코드에 대한 참조가 됩니다.

다시 말하지만, 이는 어디까지나 명세서 메커니즘이므로, 직접 접근하거나 조작하는 것은 불가능합니다.

## 환경 레코드의 구조

환경 레코드는 간단한 객체 지향 계층 구조에 존재하는 것으로 생각해 볼 수 있습니다.

즉, 환경 레코드는 추상 레코드이며, 3가지의 하위 서브클래스들이 존재합니다.

- 선언적 환경 레코드(Declarative Environment Record)
  - 함수 환경 레코드(Function Environment Record)
  - 모듈 환경 레코드(Module Environment Record)
- 객체 환경 레코드(Object Environment Record)
- 글로벌 환경 레코드(Global Environment Record)

## 선언적 환경 레코드

`선언적 환경 레코드`는 변수, 상수, let, 클래스, 모듈, 가져오기 및/또는 함수 선언을 포함하는 ECMAScript 프로그램 범위와 연결됩니다.

선언적 환경 레코드는 해당 범위 내에 포함된 선언으로 정의된 식별자 집합을 바인딩합니다.

### 함수 환경 레코드

`함수 환경 레코드`는 함수의 최상위 범위를 나타내는 데 사용되는 선언적 환경 레코드이며, 함수가 ArrowFunction이 아닌 경우 this 바인딩을 제공합니다.

### 모듈 환경 레코드

`모듈 환경 레코드`는 ECMAScript 모듈의 외부 범위를 나타내는 데 사용되는 선언적 환경 레코드입니다.

## 객체 환경 레코드

`객체 환경 레코드`는 바인딩 객체(binding object)라는 객체와 연결됩니다.

객체 환경 레코드는 바인딩 객체의 프로퍼티 이름에 직접적으로 해당하는 문자열 식별자 이름 집합을 바인딩합니다.

## 글로벌 환경 레코드

`글로벌 환경 레코드`는 공통 영역에서 처리되는 모든 ECMAScript 스크립트 요소가 공유하는 가장 바깥쪽 범위를 나타내는 데 사용됩니다.

## 실행 컨텍스트

`실행 컨텍스트`는 ECMAScript 구현에 의한 코드의 런타임 평가를 추적하는 데 사용되는 명세서에 존재하는 장치입니다.

어떤 시점에서든 실제로 코드를 실행하는 에이전트당 최대 하나의 실행 컨텍스트가 있습니다.

이를 에이전트의 실행 중인 실행 컨텍스트라고 합니다.

실행 중인 실행 컨텍스트에 대한 모든 참조는 주변 에이전트의 실행 중인 실행 컨텍스트를 나타냅니다.

## 실행 컨텍스트 스택

`실행 컨텍스트 스택`은 실행 컨텍스트를 추적하는 데 사용됩니다.

실행 중인 실행 컨텍스트는 항상 이 스택의 최상위 요소입니다.

현재 실행 중인 실행 컨텍스트와 연결된 실행 코드에서 해당 실행 컨텍스트와 연결되지 않은 실행 코드로 제어가 전송될 때마다 새로운 실행 컨텍스트가 생성됩니다.

새로 생성된 실행 컨텍스트는 스택에 푸시되고 실행 중인 실행 컨텍스트가 됩니다.

## 실행 컨텍스트의 상태 컴포넌트

ECMAScript 코드 실행 컨텍스트에는 추가 상태 구성 요소가 있습니다.

- LexicalEnvironment: 이 실행 컨텍스트 내에서 코드에 의해 생성된 식별자 참조를 확인하는 데 사용되는 환경 레코드를 식별합니다.
- VariableEnvironment: 이 실행 컨텍스트 내에서 VariableStatements에 의해 생성된 바인딩을 보유하는 환경 레코드를 식별합니다.
- PrivateEnvironment: 가장 가까운 포함 클래스에서 ClassElements에 의해 생성된 개인 이름을 보유하는 PrivateEnvironment 레코드를 식별합니다. 포함 클래스가 없으면 null입니다.

## References

https://tc39.es/ecma262/#sec-executable-code-and-execution-contexts
