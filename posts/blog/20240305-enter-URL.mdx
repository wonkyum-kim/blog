---
title: 웹 브라우저에 URL을 입력하면 일어나는 일
date: 2024-03-05
description: 큰 흐름 위주로 알아보고 추가적으로 보충해보기
tags:
  - Network
---

## 기본적으로 일어나는 과정

[웹 브라우저에 URL 입력하면 일어나는 일 - 인프라 위주](https://www.youtube.com/watch?v=GAyZ_QgYYYo&list=PLXvgR_grOs1DEoZFABFCjo7dsXt1BhVih)

사용자는 브라우저의 주소창에 주소(hostname)를 입력합니다.

웹 브라우저는 먼저 캐싱된 DNS 기록들을 확인한다. (운영체제, 브라우저, 라우터 등...)

찾지 못했다면, ISP가 운영하는 로컬 DNS 서버에 먼저 질의를 보내고 IP 주소를 전달 받는다.

만약 로컬 DNS 서버에 해당하는 웹 서버의 IP주소가 저장되어 있지 않다면, DNS 서버에 질의를 시작하게 된다.

DNS는 DNS 서버들의 계층 구조로 구현된 분산형 데이터베이스이다.

계층은 3개(root DNS 서버, top-level domain DNS 서버, authoritative DNS 서버)로 이루어져 있다.

이 순서대로 질의가 전달되고 응답을 받아서 클라이언트에 IP 주소를 전달한다.

브라우저가 IP 주소를 얻으면 웹 서버에 TCP 연결을 시도한다.

연결에 성공하면, 서버와 클라이언트는 HTTP 요청과 응답을 주고 받게 된다.

HTTP 통신을 통해 서버로부터 받은 파일들을 통해서 브라우저는 화면에 웹 페이지를 렌더링하고, 사용자가 볼 수 있게 한다.

아래는 이 과정 속에서 추가적으로 알아두면 좋을 내용을 적어두었다.

## CDN

`CDN(Contents Distribution Network)`는 다수의 지점에 분산된 서버들을 운영하여 데이터의 복사본을 저장한다. (e.g. Akamai, Limelight)

클라이언트가 DNS 서버에 요청을 보낼 때, CDN은 요청을 가로채어 사용자가 가장 원할하게 접속할 수 있는 서버의 IP 주소를 응답으로 보낸다.

## GSLB

[GSLB - Global server Load Balancing](https://www.joinc.co.kr/w/man/12/GSLB)

`GSLB(Global server Load Balancing)`은 DNS 서비스의 발전된 형태로, 지능적 DNS 서비스라고도 부른다.

### 재해 복구

DNS는 서버의 상태를 알 수 없어서 서버의 IP 주소를 얻지 못하는 사용자가 발생할 수 있다.

GSLB는 서버의 상태를 모니터링 하므로, 문제가 발생한 서버의 IP 주소를 응답에서 제외 시켜 사용자가 서버와 통신할 수 있도록 해준다.

### 로드 밸런싱

기존 DNS는 라운드 로빈 방식을 사용하여 IP 주소를 응답으로 보내는데, GSLB는 서버의 로드율을 모니터링 하여 로드가 적은 서버의 IP 주소를 응답으로 보낼 수 있다.

### 레이턴시 기반 서비스

GSLB는 각 지역별로 서버에 대한 레이턴시 정보를 가지고 있어서, 사용자에게 더 작은 레이턴시를 가지는 서버의 IP 주소를 응답으로 보낼 수 있다.

### 위치 기반 서비스

GSLB는 클라이언트의 지역 정보를 기반으로, 해당 지역을 서비스하는 서버로 연결할 수 있다.

## 클라이언트와 서버

네트워크 애플리케이션은 네트워크에서 서로 메시지를 보내는 두 프로세스로 구성된다.

두 프로세스 간의 통신 세션에서 통신을 초기화하는 프로세스를 `클라이언트`라 하고, 세션을 시작하기 위해 접속을 기다리는 프로세스를 `서버`라고 한다.

웹에서 브라우저는 클라이언트 프로세스이고, 웹 서버는 서버 프로세스다.

## 소켓

프로세스는 소켓(socket)을 통해 다른 네트워크로 메시지를 주고 받는다.

다른 프로세스로 패킷(메시지)을 보내기 위해서는 호스트의 주소와 호스트 내의 수신 프로세스를 명시하는 식별자가 필요하다.

호스트는 IP 주소로 식별되며, 호스트 내의 프로세스는 포트 번호로 식별된다.

## TCP vs UDP

`TCP(Transmission Control Protocol)`

- 클라이언트와 서버가 서로 통신하기 전에 3 way 핸드셰이킹 과정을 거친다.
- 신뢰적인 데이터 전송 서비스를 제공하여 오류 없이 올바른 순서로 전달할 수 있다.
- 혼잡 제어 서비스를 제공하여 네트워크의 부하를 줄인다.

`UDP(User Datagram Protocol)`

- 핸드셰이킹 과정을 거치지 않는다.
- 비신뢰적인 데이터 전송 서비스를 제공한다.
- 혼잡제어 방식을 사용하지 않는다.

## HTTP

`HTTP(HyperText Transfer Protocol)`은 클라이언트와 서버가 어떻게 서로 메시지를 주고 받는지 정의해 둔 것.

클라이언트는 서버에 TCP 연결을 시작하고, 연결이 이루어지면 요청 메시지와 응답 메시지를 주고 받는다.

서버는 클라이언트에 대한 정보를 유지하지 않으므로, HTTP를 비상태 프로토콜(stateless protocol)이라고 한다.

### HTTP 메서드

- GET: 데이터를 받을 때 사용
- HEAD: 응답 본문을 포함하지 않고 상태와 헤더만 반환 받음
- POST: 새로운 리소스를 생성할 때 사용.
- PUT: 새로운 리소스를 생성하거나 전체를 대체할 때 사용.
- DELETE: 리소스를 삭제할 때 사용
- PATCH: 리소스 일부를 변경할 때 사용
- CONNECT: 요청한 리소스에 대해 양방향 연결을 시작할 때 사용.
- OPTIONS: 대상 리소스에 대한 통신 가능 옵션을 설명함. CORS에서 사용됨
- TRACE: 대상 리소스에 대한 경로를 따라 메시지 루프백 테스트를 수행

### HTTP 상태 코드

- 1xx: 요청이 수신 되어 처리 중
- 2xx: 요청 성공 (success)
- 3xx: redirect
- 4xx: 클라이언트 에러
- 5xx: 서버 에러

## HTTPS

![](/posts/20240305-enter-URL/vs.png)

- 사진 출처: cloudflare

`TLS(Transport Layer Security)`를 사용해 암호화된 연결을 하는 HTTP를 `HTTPS(HTTP Secure)`라 한다.

### SSL과 TLS

`SSL(Secure Sockets Layer)`은 암호화 기반 인터넷 프로토콜을 의미한다.

현재는 더 발전된 `TLS(Transport Layer Security)`를 사용하고 있다.

SSL/TLS는 웹에서 전송되는 데이터를 암호화하여 전달하는 역할을 하게 된다.

### SSL/TLS 인증서

SSL/TLS 인증서는 사람의 신원을 확인하는 신분증과 비슷한 역할을 한다.

인증서는 웹 사이트의 원본 서버에서 호스팅 되는 데이터 파일로, 다음과 같은 정보가 포함되어 있다.

- 인증서가 발급된 대상 도메인 이름
- 발급 받은 사람, 조직, 장치
- 발급한 인증 기관
- 인증 기관의 디지털 서명
- 관련 하위 도메인
- 인증서 발급 날짜
- 인증서 만료 날짜
- 공개 키

크롬의 경우 URL 표시 줄 왼쪽에 있는 자물쇠 아이콘을 클릭하면 인증서를 볼 수 있다.

인증서는 도메인이 인증 기관(CA)에서 발급 받을 수도 있고, 자체적으로 발급 받을 수 도 있다.

CA는 인증서를 생성하고 제공하는 신뢰할 수 있는 제 3자 외부 조직을 의미한다.

하지만 기술적으로는 자체적으로 인증서를 만들 수 있는데, 이를 자체 서명 인증서라고 한다.

하지만 자체 서명 인증서를 사용하면 원본 서버가 자신이 주장하는 서버인지 확인할 수 없는 외부 기관이 없어서 신뢰성이 떨어진다.

### 대칭 암호화와 비대칭 암호화

암호화에는 대칭 암호화와 비대칭 암호화(공개 키 암호화라고도 함)가 존재한다.

대칭 암호화는 키를 하나만 두고, 통신 당사자들이 암호화와 암호 해독 모두 동일한 키를 사용한다.

비대칭 암호화에서는 두 개의 키가 존재하여, 하나는 암호화에 사용되고 다른 것은 암호 해독에 사용된다.

암호 해독에 사용되는 키는 `개인 키`라고 불리며 비공개로 유지되고, 암호화에 사용되는 키는 `공개 키`라고 불리며 공개된다.

키는 완전히 무작위적이고 예측 할 수 없어야 하는데, cloudflare에서는 `라바 램프(lava lamp)`를 사용하여 만들고 있다.

### SSL/TLS handshake

![](/posts/20240305-enter-URL/handshake.png)

- 사진 출처: bytebytego

TCP 핸드셰이크 이후에, SSL/TLS 핸드셰이크 과정이 이루어진다.

클라이언트는 '클라이언트 헬로' 메시지를 서버로 전송하면서 핸드셰이크를 개시한다.

여기에는 클라이언트가 지원하는 TLS 버전, 지원되는 암호 제품군(암호화 알고리즘 세트), 무작위 바이트 문자(클라이언트 무작위)열이 포함된다.

서버는 '클라이언트 헬로' 메시지에 대한 응답으로 서버의 SSL 인증서, 서버에서 선택한 암호 제품군, 그리고 서버에서 생성한 또 다른 무작위 바이트 문자열(서버 무작위)를 포함하는 메시지를 전송한다.

클라이언트가 서버의 SSL/TLS 인증서를 인증서 발행 기관을 통해 검증한다.

이를 통해 서버가 인증서에 명시된 서버인지, 그리고 클라이언트가 상호작용 중인 서버가 실제 해당 도메인의 소유자인지 확인한다.

클라이언트는 공개 키로 암호화 된 예비 마스터 암호라고 하는 무작위 바이트 문자열을 서버로 하나 더 전송한다.

서버는 개인 키를 사용해 예비 마스터 암호를 해독한다.

서버와 클라이언트는 클라이언트 무작위, 서버 무작위, 예비 마스터 암호를 이용해 세션 키를 생성하며 모두 같은 결과가 나와야 한다.

클라이언트는 세션 키로 암호화된 '완료' 메시지를 서버로 전송하고, 서버도 세션 키로 암호화된 '완료' 메시지를 전송하면서 핸드셰이크가 마무리된다.

이후 서버와 클라이언트 사이의 데이터 전송은 세션 키를 사용한 대칭 암호화 방식을 사용한다.

### HTTPS가 데이터 전송 시 대칭 암호화로 변경하는 이유

첫 번째 이유는 비대칭 암호화는 한 방향으로 해야 하기 때문이다.

만약 서버가 암호화된 데이터를 클라이언트로 보낸다면, 누구나 공개 키를 사용해서 해독할 수 있게 된다.

두 번째 이유는 비대칭 암호화를 하는데 많은 오버헤드가 발생하기 때문이다. 긴 세션 동안에 비대칭 암호화를 하여 데이터 전송을 하는 것은 적절하지 않다.

## 브라우저의 렌더링 과정

[Critical rendering path](https://developer.mozilla.org/en-US/docs/Web/Performance/Critical_rendering_path)

[defer, async 스크립트](https://ko.javascript.info/script-async-defer)

1. 브라우저가 서버로부터 HTML 파일을 다운로드한다.
2. 브라우저 렌더링 엔진은 HTML을 파싱하여 DOM 트리를 만든다.
3. 2번 과정에서 CSS 파일을 만나면 CSS 파일을 다운로드한다.
4. 브라우저 렌더링 엔진은 CSS도 파싱하여 CSSOM 트리를 만든다.
5. 2번 과정에서 script 태그를 만나면 동기적 또는 비동기적(e.g. async, defer, type=module) 방식으로 자바스크립트 파일을 다운로드하고 자바스크립트 엔진이 파싱하여 실행한다.
6. 화면에 보이지 않는 엘리먼트(e.g. display: none)를 제외하고 DOM 트리와 CSSOM 트리를 합친 Render 트리를 만든다.
7. Render 트리가 생성된 이후, layout 과정을 거친다. layout 단계에서는 각 노드가 화면 어느 좌표에 나타나야 하는지 계산하는 과정을 거친다.
8. layout이 끝나면 painting 과정을 거친다. painting 단계에서는 화면에 픽셀을 그린다.

## References

- [웹 브라우저에 URL 입력하면 일어나는 일 - 인프라 위주](https://www.youtube.com/watch?v=GAyZ_QgYYYo&list=PLXvgR_grOs1DEoZFABFCjo7dsXt1BhVih)
- [GSLB - Global server Load Balancing](https://www.joinc.co.kr/w/man/12/GSLB)
- [TLS(Transport Layer Security)는 무엇입니까?](https://www.cloudflare.com/ko-kr/learning/ssl/transport-layer-security-tls/)
- [Critical rendering path](https://developer.mozilla.org/en-US/docs/Web/Performance/Critical_rendering_path)
- [defer, async 스크립트](https://ko.javascript.info/script-async-defer)
- [SSL이란 무엇입니까? | SSL 정의](https://www.cloudflare.com/ko-kr/learning/ssl/what-is-ssl/)
- 컴퓨터 네트워킹 하향식 접근
